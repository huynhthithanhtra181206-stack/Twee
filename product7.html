<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set quý ông nhỏ dành cho bé nam - TWEE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f7f9fc;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        a {
            text-decoration: none;
        }

        .back-link {
            color: #618bc4;
            font-weight: 600;
            font-size: 1.1rem;
        }

        #mainImage {
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .thumb-img {
            width: 72px;
            height: 72px;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
            border: 2.5px solid transparent;
            transition: 0.3s;
        }

        .thumb-img:hover, .thumb-img.active {
            border-color: #618bc4;
            transform: scale(1.12);
        }

        .price {
            color: #1e3a8a;
            font-size: 2.4rem;
            font-weight: 800;
        }

        .btn-add-cart {
            background-color: #253f63;
            color: white;
            padding: 15px 32px;
            font-size: 1.15rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            transition: 0.3s;
        }

        .btn-add-cart:hover {
            background-color: #1a2e4d;
        }

        .btn-buy-now {
            border: 2.5px solid #618bc4;
            color: #618bc4;
            padding: 15px 32px;
            font-size: 1.15rem;
            font-weight: bold;
            background: white;
            border-radius: 8px;
            transition: 0.3s;
        }

        .btn-buy-now:hover {
            background-color: #618bc4;
            color: white;
        }

        .qty-btn {
            width: 52px;
            height: 52px;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px !important;
        }

        /* Nút giỏ hàng nổi */
        .cart-float-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #0d6efd;
            color: white;
            border: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .cart-float-btn:hover {
            transform: scale(1.1);
            background-color: #0b5ed7;
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #dc3545;
            color: white;
            font-size: 12px;
            font-weight: bold;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        @media (max-width: 576px) {
            .product-title {
                font-size: 1.38rem !important;
            }

            .price {
                font-size: 2rem !important;
            }

            .thumb-img {
                width: 60px;
                height: 60px;
            }

            .btn {
                font-size: 1rem !important;
                padding: 12px 22px !important;
            }

            .qty-btn {
                width: 46px;
                height: 46px;
                font-size: 1.4rem;
            }
        }

        .product-card {
            overflow: hidden;
            position: relative;
        }

        .img-wrapper {
            position: relative;
            overflow: hidden;
        }

        .view-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: 0.3s;
            z-index: 10;
            padding: 10px 20px;
            font-weight: bold;
        }

        .img-wrapper img {
            transition: 0.3s;
            width: 100%;
            height: 400px;
            object-fit: cover;
        }

        .product-card:hover .img-wrapper img {
            opacity: 0.6;
            transform: scale(1.05);
        }

        .product-card:hover .view-btn {
            opacity: 1;
        }
    </style>
</head>
<body>

<button class="cart-float-btn" onclick="openCartModal()">
    <i class="fas fa-shopping-cart"></i>
    <span class="cart-count"    id="floatingCartCount"   style="display: none;">0</span>
</button>

<div class="container-fluid py-4" style="background-color:#f7f9fc; min-height: 100vh;">
    <div class="container px-4">
        <div class="mb-4"><a href="SanPham.html" class="back-link">← QUAY LẠI DANH SÁCH</a></div>

        <div class="row g-4">
            <div class="col-lg-5">
                <div class="text-center mb-4">
                    <img src="anh/sp/vet.jpg" id="mainImage" class="img-fluid" alt="Set quý ông nhỏ">
                </div>
                <div class="d-flex justify-content-center gap-3 overflow-x-auto pb-2">
                    <img src="anh/sp/vet.jpg" class="thumb-img active" onclick="changeImg(this)" alt="">
                    <img src="anh/sp/vet1.jpg" class="thumb-img" onclick="changeImg(this)" alt="">
                    <img src="anh/sp/vet2.jpg" class="thumb-img" onclick="changeImg(this)" alt="">
                    <img src="anh/sp/vet3.jpg" class="thumb-img" onclick="changeImg(this)" alt="">
                    <img src="anh/sp/vet4.jpg" class="thumb-img" onclick="changeImg(this)" alt="">
                </div>
            </div>

            <div class="col-lg-7">
                <h1 class="fw-bold mb-3 product-title" style="color:#253f63; line-height: 1.4;">
                    Set quý ông nhỏ dành cho bé nam, sang trọng, hiện đại từ 3kg đến 10kg</h1>
                <p class="mb-3" style="color:#253f63; font-size:1.05rem;">
                    Mã SP: <span style="color:#618bc4;">2012835</span> 
                    • Tình trạng: <span style="color:#618bc4;">Còn hàng</span>
                    • Thương hiệu: <span style="color:#618bc4;">TWEE</span>
                </p>

                <div class="d-flex align-items-baseline mb-4">
                    <span class="fw-bold me-3" style="color:#253f63;">Giá:</span>
                    <span class="price">749.000đ</span>
                </div>

                <div class="mb-4">
                    <p class="fw-bold mb-2" style="color:#253f63;">Màu sắc:</p>
                    <div class="d-flex gap-4 flex-wrap">
                        <label>
                            <input type="radio" name="mausac" class="me-1" checked> Đen
                        </label>
                            <label>
                                <input type="radio" name="mausac" class="me-1"> Xám
                            </label>
                            <label>
                                <input type="radio" name="mausac" class="me-1"> Xanh Navy
                            </label>
                            <label>
                                <input type="radio"  name="mausac"  class="me-1"> Nâu
                            </label>
                        </div>
                </div>

                <div class="mb-4">
                    <p class="fw-bold mb-2" style="color:#253f63;">Size:</p>
                    <div class="d-flex flex-wrap gap-2">
                        <input type="radio" class="btn-check" name="Size" id="sz2"  checked>
                        <label class="btn btn-outline-secondary" for="sz2">sz2: 3-4kg</label>
                        <input type="radio" class="btn-check" name="Size" id="sz4">
                        <label class="btn btn-outline-secondary" for="sz4">sz4:4-5kg</label>
                        <input type="radio" class="btn-check" name="Size" id="sz6">
                        <label class="btn btn-outline-secondary" for="sz6">sz6: 5-6kg</label>
                        <input type="radio" class="btn-check" name="Size"  id="sz8">
                        <label class="btn btn-outline-secondary" for="sz8">sz8: 6-7kg</label>
                        <input type="radio" class="btn-check"name="Size" id="sz10">
                        <label class="btn btn-outline-secondary" for="sz10">sz10: 7-8kg</label>
                        <input type="radio"  class="btn-check" name="Size" id="sz12">
                        <label class="btn btn-outline-secondary" for="sz12">sz12: 8-10kg</label>
                    </div>
                </div>

                <div class="mb-4">
                    <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#sizeModal">
                        Bảng quy đổi kích cỡ
                    </button>
                </div>

                <div class="d-flex align-items-center gap-3 mb-5">
                    <span class="fw-bold" style="color:#253f63;">Số lượng:</span>
                    <div class="border rounded d-flex">
                        <button class="btn qty-btn" onclick="changeQty(-1)">−</button>
                        <label for="qty"></label>
                        <input type="text" id="qty" value="1" class="text-center border-0" style="width:70px;" readonly>
                        <button class="btn qty-btn" onclick="changeQty(1)">+</button>
                    </div>
                </div>

                <div class="d-grid d-md-block gap-3">
                    <button class="btn btn-add-cart mb-3 mb-md-0 me-md-3"
                            onclick="addToCart('Set quý ông nhỏ dành cho bé nam', '749.000đ', 'anh/sp/vet.jpg')">
                        THÊM VÀO GIỎ HÀNG
                    </button>
                    <button class="btn btn-buy-now"
                            onclick="buyNow('Set quý ông nhỏ dành cho bé nam', '749.000đ', 'anh/sp/vet.jpg')">
                        MUA NGAY
                    </button>
                </div>
            </div>
        </div>

        <div class="mt-5">
            <h4 class="fw-bold mb-4" style="color:#253f63;">Đánh giá từ khách hàng</h4>
            <div class="card p-4 mb-4 shadow-sm">
                <h6 class="fw-bold mb-3">Để lại đánh giá của bạn</h6>
                <label>
          <textarea class="form-control mb-3" rows="3" placeholder="Chia sẻ cảm nhận..."></textarea>
            </label>
                <button class="btn btn-primary">Gửi bình luận</button>
            </div>

            <div class="card p-4 mb-3 shadow-sm">
                <h6 class="fw-bold">Nguyễn Thị Lan</h6>
                <div class="text-warning mb-2">★★★★★</div>
                <p>Sản phẩm rất đẹp, màu giống hình. Chất vải mềm, bé nhà mình mặc rất thích!</p>
                <small class="text-muted">12/10/2024</small>
            </div>

            <div class="card p-4 mb-3 shadow-sm">
                <h6 class="fw-bold">Trần Phúc</h6>
                <div class="text-warning mb-2">★★★★☆</div>
                <p>Giao hàng nhanh, vải ok nhưng form hơi nhỏ, nên chọn lớn hơn 1 size nha mọi người.</p>
                <small class="text-muted">03/11/2024</small>
            </div>

            <div class="card p-4 mb-5 shadow-sm">
                <h6 class="fw-bold">Minh Anh</h6>
                <div class="text-warning mb-2">★★★★★</div>
                <p>Chất liệu thoáng mát, bé chạy nhảy thoải mái. Rất đáng mua!</p>
                <small class="text-muted">29/09/2024</small>
            </div>

        </div>

        <h4 class="fw-bold mb-4" style="color:#253f63;">Sản phẩm liên quan</h4>
        <div class="row">
            <div class="col-md-4 col-sm-6 mb-4">
                <div class="card product-card shadow-sm">
                    <div class="img-wrapper">
                        <div>
                            <img src="anh/sp/vet.jpg" class="card-img-top" alt="Set quý ông nhỏ">
                        </div>
                        <a href="product7.html" class="btn btn-primary view-btn">Xem chi tiết</a>
                    </div>
                    <div class="card-body text-center">
                        <h6 class="card-title">Set quý ông nhỏ</h6>
                        <p class="text-muted fw-bold">Giá: 749.000 Đ</p>
                    </div>
                </div>
            </div>

            <div class="col-md-4 col-sm-6 mb-4">
                <div class="card product-card shadow-sm">
                    <div class="img-wrapper">
                        <div>
                            <img src="anh/sp/dichoi.jpg" class="card-img-top" alt="Set Thu Đông Búp Bê">
                        </div>
                        <a href="product8.html" class="btn btn-primary view-btn">Xem chi tiết</a>
                    </div>
                    <div class="card-body text-center">
                        <h6 class="card-title">Set Thu Đông Búp Bê</h6>
                        <p class="text-muted fw-bold">Giá: 509.000 Đ</p>
                    </div>
                </div>
            </div>

            <div class="col-md-4 col-sm-6 mb-4">
                <div class="card product-card shadow-sm">
                    <div class="img-wrapper">
                        <div>
                            <img src="anh/sp/aokhoac.jpg" class="card-img-top" alt="Áo khoác mùa đông">
                        </div>
                        <a href="product9.html" class="btn btn-primary view-btn">Xem chi tiết</a>
                    </div>
                    <div class="card-body text-center">
                        <h6 class="card-title">Áo khoác mùa đông</h6>
                        <p class="text-muted fw-bold">Giá: 739.000 Đ</p>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="sizeModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">Bảng Size</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <table class="table table-bordered text-center">
                    <thead class="table-light">
                    <tr>
                        <th>Size</th>
                        <th>Cân nặng</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>sz2</td>
                        <td>3-4kg</td>
                    </tr>
                    <tr>
                        <td>sz4</td>
                        <td>4-5kg</td>
                    </tr>
                    <tr>
                        <td>sz6</td>
                        <td>5-6kg</td>
                    </tr>
                    <tr>
                        <td>sz8</td>
                        <td>6-7kg</td>
                    </tr>
                    <tr>
                        <td>sz10</td>
                        <td>7-8kg</td>
                    </tr>
                    <tr>
                        <td>sz12</td>
                        <td>8-10kg</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title fw-bold">Giỏ hàng TWEE Store</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <table class="table align-middle">
                    <thead>
                    <tr>
                        <th>Sản phẩm</th>
                        <th>Đơn giá</th>
                        <th>SL</th>
                        <th>Thành tiền</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody id="cartItems"></tbody>
                </table>
                <div class="d-flex justify-content-end mt-3">
                    <h5 class="me-2">Tổng:</h5>
                    <h4 class="text-danger fw-bold" id="cartTotal">0đ</h4>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Xem tiếp</button>
                <button type="button" class="btn btn-danger" id="btnProceedToCheckout">Đặt hàng ngay</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="checkoutModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title fw-bold">Thanh toán</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="checkoutForm">
                    <div class="mb-3">
                        <label>Họ tên</label>
                        <label for="customerName"></label>
                        <input type="text"  class="form-control"  id="customerName"required>
                    </div>
                    <div class="mb-3">
                        <label>SĐT</label>
                        <label for="customerPhone"></label>
                        <input type="tel" class="form-control" id="customerPhone"  required>
                    </div>
                    <div class="mb-3">
                        <label>Địa chỉ</label>
                        <label for="customerAddress"></label>
                        <textarea class="form-control" id="customerAddress" required></textarea>
                    </div>

                    <div class="mb-3">
                        <label>Thanh toán</label>
                        <label for="paymentMethod"></label>
                        <select class="form-select" id="paymentMethod">
                        <option value="cod">COD</option>
                        <option value="banking">Chuyển khoản</option>
                        </select>
                    </div>

                    <div id="bankingInfo" class="alert alert-info d-none">
                        <strong>Vietcombank</strong><br>STK: 9999888866
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="btnBackToCart">Quay lại</button>
                <button type="button" class="btn btn-success" id="btnConfirmOrder">Xác nhận</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- JS NỘI BỘ: GIỎ HÀNG & THANH TOÁN ---
    function changeImg(el) {
        document.getElementById('mainImage').src = el.src;
        document.querySelectorAll('.thumb-img').forEach(img => img.classList.remove('active'));
        el.classList.add('active');
    }

    function changeQty(n) {
        let input = document.getElementById('qty');
        if (input) {
            let val = parseInt(input.value) + n;
            if (val < 1) val = 1;
            input.value = val;
        }
    }

    function formatCurrency(amount) {
        return parseInt(amount).toLocaleString('vi-VN') + 'đ';
    }

    function parseCurrency(str) {
        return parseFloat(str.toString().replace(/[^0-9]/g, ''));
    }

    // 1. KHỞI TẠO: Lấy giỏ hàng từ kho chung 'tweeCart'
    let cart = JSON.parse(localStorage.getItem('tweeCart')) || [];

    // Hàm lưu vào kho chung
    function saveCartToStorage() {
        localStorage.setItem('tweeCart', JSON.stringify(cart));
    }

    function openCartModal() {
        const modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('cartModal'));
        modal.show();
    }

    // HÀM 1: THÊM VÀO GIỎ (Cộng dồn & Mở giỏ)
    function addToCart(name, priceStr, imgUrl) {
        if (event) event.preventDefault();
        const qtyInput = document.getElementById('qty');
        const quantityToAdd = qtyInput ? parseInt(qtyInput.value) : 1;

        const existingItem = cart.find(item => item.name === name);
        if (existingItem) {
            existingItem.quantity += quantityToAdd;
        } else {
            cart.push({
                name: name,
                price: parseCurrency(priceStr),
                img: imgUrl,
                quantity: quantityToAdd
            });
        }

        saveCartToStorage(); // <--- QUAN TRỌNG: Lưu ngay để Trang Chủ thấy
        renderCart();
        openCartModal();
    }

    // HÀM 2: MUA NGAY (Không cộng dồn & Mở giỏ)
    function buyNow(name, priceStr, imgUrl) {
        if (event) event.preventDefault();
        const qtyInput = document.getElementById('qty');
        const quantityToAdd = qtyInput ? parseInt(qtyInput.value) : 1;

        const existingItem = cart.find(item => item.name === name);
        if (!existingItem) {
            cart.push({
                name: name,
                price: parseCurrency(priceStr),
                img: imgUrl,
                quantity: quantityToAdd
            });
            saveCartToStorage(); // <--- QUAN TRỌNG
        }
        renderCart();
        openCartModal();
    }

    function renderCart() {
        const container = document.getElementById('cartItems');
        const totalEl = document.getElementById('cartTotal');
        const countEl = document.getElementById('floatingCartCount');

        let totalCount = 0;
        cart.forEach(item => totalCount += item.quantity);
        if (countEl) {
            countEl.innerText = totalCount;
            countEl.style.display = totalCount > 0 ? 'flex' : 'none';
        }

        if (cart.length === 0) {
            container.innerHTML = '<tr><td colspan="5" class="text-center">Giỏ trống</td></tr>';
            totalEl.innerText = '0đ';
            return;
        }

        container.innerHTML = '';
        let total = 0;
        cart.forEach((item, index) => {
            const itemTotal = item.price * item.quantity;
            total += itemTotal;
            container.innerHTML += `<tr>
                <td><div class="d-flex align-items-center"><img src="${item.img}" style="width:50px; margin-right:10px;" alt=""><span>${item.name}</span></div></td>
                <td>${formatCurrency(item.price)}</td>
                <td><input type="number" class="form-control form-control-sm" value="${item.quantity}" min="1" style="width:60px;" onchange="updateQuantity(${index}, this.value)"></td>
                <td>${formatCurrency(itemTotal)}</td>
                <td><button class="btn btn-sm btn-outline-danger" onclick="removeFromCart(${index})">Xóa</button></td>
            </tr>`;
        });
        totalEl.innerText = formatCurrency(total);
    }

    function updateQuantity(index, newQty) {
        if (newQty < 1) newQty = 1;
        cart[index].quantity = parseInt(newQty);
        saveCartToStorage(); // Lưu lại khi sửa
        renderCart();
    }

    function removeFromCart(index) {
        if (confirm('Xóa?')) {
            cart.splice(index, 1);
            saveCartToStorage(); // Lưu lại khi xóa
            renderCart();
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        renderCart(); // Render ngay khi vào trang để cập nhật số lượng trên nút nổi

        const cartModalEl = document.getElementById('cartModal');
        const checkoutModalEl = document.getElementById('checkoutModal');
        const phoneInput = document.getElementById('customerPhone');
        if (phoneInput) phoneInput.addEventListener('input', (e) => {
            let v = e.target.value.replace(/[^0-9]/g, '');
            if (v.length > 10) v = v.slice(0, 10);
            e.target.value = v;
        });

        document.getElementById('btnProceedToCheckout').addEventListener('click', () => {
            if (cart.length === 0) {
                alert("Giỏ trống!");
                return;
            }
            bootstrap.Modal.getOrCreateInstance(cartModalEl).hide();
            bootstrap.Modal.getOrCreateInstance(checkoutModalEl).show();
        });

        document.getElementById('btnBackToCart').addEventListener('click', () => {
            bootstrap.Modal.getOrCreateInstance(checkoutModalEl).hide();
            bootstrap.Modal.getOrCreateInstance(cartModalEl).show();
        });

        document.getElementById('paymentMethod').addEventListener('change', (e) => {
            const info = document.getElementById('bankingInfo');
            if (e.target.value === 'banking') info.classList.remove('d-none'); else info.classList.add('d-none');
        });

        document.getElementById('btnConfirmOrder').addEventListener('click', () => {
            const name = document.getElementById('customerName').value;
            const phone = document.getElementById('customerPhone').value;
            const addr = document.getElementById('customerAddress').value;
            if (!name || !phone || !addr) {
                alert("Thiếu thông tin!");
                return;
            }

            // Tạo đơn hàng
            const newOrder = {
                id: 'DH' + Date.now(),
                customer: {name, phone, address: addr},
                items: cart,
                total: document.getElementById('cartTotal').innerText,
                date: new Date().toLocaleString('vi-VN'),
                status: 'Chờ xử lý'
            };

            // Lưu đơn hàng vào danh sách đơn hàng của Admin
            let orders = JSON.parse(localStorage.getItem('tweeOrders')) || [];
            orders.push(newOrder);
            localStorage.setItem('tweeOrders', JSON.stringify(orders));

            alert("Thành công! Mã: " + newOrder.id);

            // Xóa giỏ hàng sau khi mua xong
            cart = [];
            saveCartToStorage(); // Cập nhật kho rỗng
            renderCart();

            document.getElementById('checkoutForm').reset();
            bootstrap.Modal.getOrCreateInstance(checkoutModalEl).hide();
        });
    });
</script>
</body>
</html>